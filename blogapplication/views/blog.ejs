<!DOCTYPE html>
<html lang="en">

<head>
  <%- include('./partials/head') %>
    <title>
      <%= blog.title %>
    </title>
</head>

<body>

  <%- include('./partials/nav') %>

    <div class="container py-5">

      <% if (blog) { %>

        <div class="row justify-content-center">
          <div class="col-lg-8">

            <!-- ================= Blog Card ================= -->
            <div class="card shadow border-0">

              <!-- Cover Image -->
              <img src="<%= blog.coverimageurl %>" class="card-img-top img-fluid"
                style="max-height:450px; object-fit:cover;" alt="Blog Cover">

              <div class="card-body p-4">

                <!-- Title -->
                <h1 class="card-title mb-4 fw-bold">
                  <%= blog.title %>
                </h1>

                <!-- Blog Content -->
                <p class="card-text fs-5 lh-lg">
                  <%= blog.body %>
                </p>

                <hr class="my-4">
                <%if(blog.createdBy){%>
                  <!-- Author Section -->
                  <div class="d-flex align-items-center">
                    <%if(blog.createdBy){%>
                      <img src="<%= blog.createdBy.profileimageurl %>" class="rounded-circle me-3" width="45"
                        height="45" style="object-fit: cover;">
                      <%}%>


                        <div>
                          <div class="fw-semibold">
                            <%= blog.createdBy.fullname %>
                          </div>

                          <% if (blog.createdAt) { %>
                            <small class="text-muted">
                              Posted on <%= blog.createdAt.toDateString() %>
                            </small>
                            <% } %>
                        </div>
                        <% } %>
                  </div>

              </div>
            </div>


            <!-- ================= Comment Section ================= -->

            <div class="mt-5">

              <h4 class="mb-4">Comments</h4>

              <!-- Comment Form -->
              <% if (locals.user) { %>

                <div class="card mb-4 border-0 shadow-sm">
                  <div class="card-body">

                    <form action="/blog/comment/<%= blog._id %>" method="POST">

                      <div class="d-flex gap-3">

                        <!-- Logged-in User Image -->
                        <img src="<%= user.profileimageurl %>" class="rounded-circle" width="45" height="45"
                          style="object-fit: cover;">

                        <div class="flex-grow-1">

                          <textarea name="Content" class="form-control mb-2" rows="3"
                            placeholder="Write your comment..." required></textarea>

                          <div class="text-end">
                            <button type="submit" class="btn btn-primary btn-sm px-4">
                              Post
                            </button>
                          </div>

                        </div>

                      </div>

                    </form>

                  </div>
                </div>

                <% } else { %>

                  <div class="alert alert-info">
                    Please login to post a comment.
                  </div>

                  <% } %>


                    <!-- ================= Comment List ================= -->

                    <% if (comments &&  comments.length> 0) { %>

                      <% comments.forEach((comment)=> { %>

                        <div class="d-flex gap-3 mb-4">

                          <!-- Comment User Image -->
                          <img src="<%= comment.createdBy.profileimageurl %>" class="rounded-circle" width="40"
                            height="40" style="object-fit: cover;">

                          <div class="flex-grow-1">

                            <div class="bg-light p-3 rounded shadow-sm">

                              <div class="d-flex justify-content-between align-items-center">

                                <div>
                                  <div class="fw-semibold">
                                    <%= comment.createdBy.fullname %>
                                  </div>

                                  <small class="text-muted">
                                    <%= comment.createdAt ? comment.createdAt.toDateString() : "" %>
                                  </small>
                                </div>

                              </div>

                              <div class="mt-2">
                                <%= comment.Content %>
                              </div>

                            </div>

                          </div>

                        </div>

                        <% }) %>

                          <% } else { %>

                            <p class="text-muted">No comments yet. Be the first to comment!</p>

                            <% } %>

            </div>

            <!-- Back Button -->
            <div class="mt-4">
              <a href="/" class="btn btn-outline-primary">
                ‚Üê Back to Home
              </a>
            </div>

          </div>
        </div>

        <% } else { %>

          <div class="alert alert-danger text-center">
            Blog not found.
          </div>

          <% } %>

    </div>

    <%- include('./partials/script') %>

</body>

</html>